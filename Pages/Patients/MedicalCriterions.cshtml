@page 
@model CNSVM.Pages.Patients.MedicalCriterionsModel
@{
    ViewData["Title"] = "Criterio de Votación";
}

<div class="container mt-5">
    <h2>@Model.medicamentPrescription.Medicament.Name @Model.medicamentPrescription.Medicament.PharmaceuticalForm</h2> <!-- Mostrar el nombre del doctor -->
    <h4>@Model.MedicamentName</h4> <!-- Mostrar el nombre del medicamento -->

    <form method="post">
        <div class="card p-3 mt-3">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h5>¿Estás de acuerdo con este medicamento?</h5>
                </div>
                <div class="col-md-4">
                    <div class="btn-group">
                        <button type="button" class="btn btn-vote" id="doctor-yes" onclick="handleVote('yes')">✔️ Sí</button>
                        <button type="button" class="btn btn-vote" id="doctor-no" onclick="handleVote('no')">❌ No</button>
                    </div>
                </div>
            </div>
            <div id="justify" class="form-group mt-3" style="display: none;">
                <textarea class="form-control" name="justification" id="justification" rows="3" placeholder="Justificación"></textarea>
            </div>

            <input type="hidden" name="doctorVote" id="doctorVote" />
            <input type="hidden" name="doctorId" value="@Model.UserName" />
            <input type="hidden" name="prescriptionId" value="@Model.MedicamentName" />

            <button type="submit" class="btn btn-primary btn-block mt-4">Enviar voto</button>
        </div>
    </form>

    <!-- Tabla de los médicos con sus votos y justificaciones -->
    <div class="mt-5">
        <h3>Historial de Votaciones</h3>
        @if (Model.MedicalCriterions != null && Model.MedicalCriterions.Any())
        {
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Médico</th>
                        <th>Voto</th>
                        <th>Razón</th>
                    </tr>
                </thead>
                <tbody>
               
                        @foreach (var criterion in Model.MedicalCriterions)
                        {
                            <tr>
                                <td>@criterion.DoctorFullName</td>
                                <td>@(criterion.Criterion == 'A' ? 'A' : 'R')</td>
                                <td>@criterion.CriterionReason</td>
                            </tr>
                        }
                

                </tbody>
            </table>
        }
        else
        {
            <div class="alert alert-info" role="alert">
                No hay prescripciones disponibles para este paciente.
            </div>
        }
    </div>
</div>


@section Scripts {
    <script>
        function handleVote(vote) {
            document.getElementById("doctorVote").value = vote;

            const yesButton = document.getElementById("doctor-yes");
            const noButton = document.getElementById("doctor-no");

            if (vote === 'yes') {
                yesButton.classList.add('btn-yes-active');
                yesButton.classList.remove('btn-vote');
                noButton.classList.remove('btn-no-active');
                noButton.classList.add('btn-vote');
                document.getElementById("justify").style.display = 'none';
            } else if (vote === 'no') {
                noButton.classList.add('btn-no-active');
                noButton.classList.remove('btn-vote');
                yesButton.classList.remove('btn-yes-active');
                yesButton.classList.add('btn-vote');
                document.getElementById("justify").style.display = 'block';
            }
        }
    </script>
}